var g=Object.defineProperty;var w=(o,e,t)=>e in o?g(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var l=(o,e,t)=>w(o,typeof e!="symbol"?e+"":e,t);const f=typeof window<"u"&&window.location.hostname==="localhost",y={sync:{get:async o=>{const e=Array.isArray(o)?o:[o],t={};for(const n of e){const a=localStorage.getItem(`chrome.storage.sync.${n}`);t[n]=a?JSON.parse(a):void 0}return t},set:async o=>{Object.entries(o).forEach(([e,t])=>{localStorage.setItem(`chrome.storage.sync.${e}`,JSON.stringify(t))})}}},h=f?y:chrome.storage;class m{constructor(){l(this,"defaultSettings",{preferredSource:"random",showSource:!0,favoriteQuotes:[],lastFetchTime:0,selectedTheme:"default",themeMode:"system",selectedLightFont:"elegant",selectedDarkFont:"monospace",fontFollowsTheme:!0,selectedQuoteFont:"elegant"})}async getSettings(){try{const e=await h.sync.get("settings");return{...this.defaultSettings,...e.settings}}catch(e){return console.warn("Storage service error:",e),this.defaultSettings}}async saveSettings(e){try{const n={...await this.getSettings(),...e};await h.sync.set({settings:n})}catch(t){console.warn("Storage service error:",t)}}async cacheQuote(e){try{const t={...e,timestamp:Date.now()};await this.saveSettings({cachedQuote:t,lastFetchTime:Date.now()})}catch(t){console.warn("Cache quote error:",t)}}async getCachedQuote(){try{const t=(await this.getSettings()).cachedQuote;return t&&Date.now()-t.timestamp<24*60*60*1e3?t:null}catch(e){return console.warn("Get cached quote error:",e),null}}async shouldFetchNewQuote(){try{const e=await this.getSettings();return Date.now()-e.lastFetchTime>10*60*1e3}catch(e){return console.warn("Should fetch new quote error:",e),!0}}async getSelectedTheme(){try{return(await this.getSettings()).selectedTheme}catch(e){return console.warn("Get selected theme error:",e),"default"}}async saveSelectedTheme(e){try{await this.saveSettings({selectedTheme:e})}catch(t){console.warn("Save selected theme error:",t)}}async getSelectedQuoteFont(){try{return(await this.getSettings()).selectedQuoteFont||"classic"}catch(e){return console.warn("Get selected quote font error:",e),"classic"}}async saveSelectedQuoteFont(e){try{await this.saveSettings({selectedQuoteFont:e})}catch(t){console.warn("Save selected quote font error:",t)}}async getSelectedUIFont(){try{return(await this.getSettings()).selectedUIFont||"readable"}catch(e){return console.warn("Get selected UI font error:",e),"readable"}}async saveSelectedUIFont(e){try{await this.saveSettings({selectedUIFont:e})}catch(t){console.warn("Save selected UI font error:",t)}}async cachePrefetchedQuote(e){try{const t={...e,timestamp:Date.now()};await this.saveSettings({prefetchedQuote:t})}catch(t){console.warn("Cache prefetched quote error:",t)}}async getPrefetchedQuote(){try{const t=(await this.getSettings()).prefetchedQuote;return t&&Date.now()-t.timestamp<60*60*1e3?t:null}catch(e){return console.warn("Get prefetched quote error:",e),null}}async consumePrefetchedQuote(){try{const e=await this.getPrefetchedQuote();return e&&(await this.cacheQuote(e),await this.saveSettings({prefetchedQuote:void 0})),e}catch(e){return console.warn("Consume prefetched quote error:",e),null}}}const u=new m,d=[{text:"The only way to do great work is to love what you do.",author:"Steve Jobs",source:"Built-in"},{text:"Innovation distinguishes between a leader and a follower.",author:"Steve Jobs",source:"Built-in"},{text:"The future belongs to those who believe in the beauty of their dreams.",author:"Eleanor Roosevelt",source:"Built-in"},{text:"It is during our darkest moments that we must focus to see the light.",author:"Aristotle",source:"Built-in"},{text:"Success is not final, failure is not fatal: it is the courage to continue that counts.",author:"Winston Churchill",source:"Built-in"}],r=typeof window<"u"&&window.location.hostname==="localhost";class p{getRandomFallback(){const e=Math.floor(Math.random()*d.length);return d[e]}async fetchFromZenQuotes(){var e;try{r&&console.log("Fetching from ZenQuotes...");const t=await fetch("https://zenquotes.io/api/random");if(!t.ok)throw new Error(`ZenQuotes request failed: ${t.status} ${t.statusText}`);const n=await t.json();if(n&&n.length>0){const a=String(((e=n[0])==null?void 0:e.q)??"");if(/too many requests/i.test(a))throw new Error("ZenQuotes rate limited (message body)");const c={text:n[0].q,author:n[0].a,source:"ZenQuotes"};return r&&console.log("ZenQuotes response:",c),c}throw new Error("No quote data received")}catch(t){throw r&&console.warn("ZenQuotes fetch failed:",t),t}}async fetchFromQuoteGarden(){try{r&&console.log("Fetching from QuoteGarden...");const e=await fetch("https://quote-garden.herokuapp.com/api/v3/quotes/random");if(!e.ok)throw new Error(`QuoteGarden request failed: ${e.status} ${e.statusText}`);const t=await e.json();if(t&&t.statusCode===200&&t.data){const n={text:t.data.quoteText.replace(/[""]/g,""),author:t.data.quoteAuthor,source:"Quote Garden"};return r&&console.log("QuoteGarden response:",n),n}throw new Error("No quote data received")}catch(e){throw r&&console.warn("QuoteGarden fetch failed:",e),e}}async getRandomQuote(){r&&console.log("Getting random quote...");const e=[()=>this.fetchFromZenQuotes(),()=>this.fetchFromQuoteGarden()];for(const t of e)try{return await t()}catch{continue}return r&&console.log("All APIs failed, using fallback quote"),this.getRandomFallback()}async getTodaysQuote(){var e;try{r&&console.log("Getting today's quote...");const t=await fetch("https://zenquotes.io/api/today");if(!t.ok)throw new Error(`ZenQuotes today request failed: ${t.status} ${t.statusText}`);const n=await t.json();if(n&&n.length>0){const a=String(((e=n[0])==null?void 0:e.q)??"");if(/too many requests/i.test(a))throw new Error("ZenQuotes rate limited (message body)");const c={text:n[0].q,author:n[0].a,source:"ZenQuotes (Today)"};return r&&console.log("Today's quote response:",c),c}throw new Error("No today quote available")}catch(t){return r&&console.warn("Today's quote fetch failed, falling back to random:",t),this.getRandomQuote()}}async prefetchNextQuote(){try{r&&console.log("Prefetching next quote...");const e=await this.getRandomQuote();await u.cachePrefetchedQuote({...e,source:e.source??"Unknown"}),r&&console.log("Next quote prefetched:",e)}catch(e){r&&console.warn("Prefetch failed:",e)}}}const i=new p;let s=!0;chrome.storage.local.get(["dqEnabled"],o=>{s=o.dqEnabled!==!1;const e=s?{16:"icons/icon16.png",32:"icons/icon32.png",48:"icons/icon48.png",128:"icons/icon128.png"}:{16:"icons/icon16_gray.png",32:"icons/icon32_gray.png",48:"icons/icon48_gray.png",128:"icons/icon128_gray.png"};chrome.action.setIcon({path:e}),chrome.action.setTitle({title:s?"Click to hide quote":"Click to show quote"})});chrome.action.onClicked.addListener(async()=>{s=!s;const o=s?{16:"icons/icon16.png",32:"icons/icon32.png",48:"icons/icon48.png",128:"icons/icon128.png"}:{16:"icons/icon16_gray.png",32:"icons/icon32_gray.png",48:"icons/icon48_gray.png",128:"icons/icon128_gray.png"};chrome.action.setIcon({path:o}),chrome.action.setTitle({title:s?"Click to hide quote":"Click to show quote"}),chrome.storage.local.set({dqEnabled:s})});chrome.runtime.onInstalled.addListener(async()=>{chrome.alarms.create("dailyQuote",{delayInMinutes:0,periodInMinutes:24*60});const o=await i.getTodaysQuote();await u.cacheQuote({text:o.text,author:o.author,source:o.source||"Unknown"})});chrome.alarms.onAlarm.addListener(async o=>{if(o.name==="dailyQuote"){const e=await i.getTodaysQuote();await u.cacheQuote({text:e.text,author:e.author,source:e.source||"Unknown"}),await i.prefetchNextQuote()}});export{i as q,u as s};
