var w=Object.defineProperty;var y=(r,e,t)=>e in r?w(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>y(r,typeof e!="symbol"?e+"":e,t);const m=typeof window<"u"&&window.location.hostname==="localhost",p={sync:{get:async r=>{const e=Array.isArray(r)?r:[r],t={};for(const o of e){const s=localStorage.getItem(`chrome.storage.sync.${o}`);t[o]=s?JSON.parse(s):void 0}return t},set:async r=>{Object.entries(r).forEach(([e,t])=>{localStorage.setItem(`chrome.storage.sync.${e}`,JSON.stringify(t))})}}},g=m?p:chrome.storage;class Q{constructor(){d(this,"defaultSettings",{preferredSource:"random",showSource:!0,favoriteQuotes:[],lastFetchTime:0,selectedTheme:"default",themeMode:"system",selectedLightFont:"elegant",selectedDarkFont:"monospace",fontFollowsTheme:!0,selectedQuoteFont:"elegant"})}async getSettings(){try{const e=await g.sync.get("settings");return{...this.defaultSettings,...e.settings}}catch(e){return console.warn("Storage service error:",e),this.defaultSettings}}async saveSettings(e){try{const o={...await this.getSettings(),...e};await g.sync.set({settings:o})}catch(t){console.warn("Storage service error:",t)}}async cacheQuote(e){try{if(this.isErrorQuote(e)){console.warn("Refusing to cache error quote:",e.text.substring(0,50));return}const t={...e,timestamp:Date.now()};await this.saveSettings({cachedQuote:t,lastFetchTime:Date.now()})}catch(t){console.warn("Cache quote error:",t)}}isErrorQuote(e){return[/too many requests/i,/rate limit/i,/auth key/i,/unlimited access/i].some(o=>o.test(e.text)||o.test(e.author))}async getCachedQuote(){try{const t=(await this.getSettings()).cachedQuote;return t?this.isErrorQuote(t)?(await this.saveSettings({cachedQuote:void 0}),null):Date.now()-t.timestamp<24*60*60*1e3?t:null:null}catch(e){return console.warn("Get cached quote error:",e),null}}async shouldFetchNewQuote(){try{const e=await this.getSettings();return Date.now()-e.lastFetchTime>10*60*1e3}catch(e){return console.warn("Should fetch new quote error:",e),!0}}async getSelectedTheme(){try{return(await this.getSettings()).selectedTheme}catch(e){return console.warn("Get selected theme error:",e),"default"}}async saveSelectedTheme(e){try{await this.saveSettings({selectedTheme:e})}catch(t){console.warn("Save selected theme error:",t)}}async getSelectedQuoteFont(){try{return(await this.getSettings()).selectedQuoteFont||"classic"}catch(e){return console.warn("Get selected quote font error:",e),"classic"}}async saveSelectedQuoteFont(e){try{await this.saveSettings({selectedQuoteFont:e})}catch(t){console.warn("Save selected quote font error:",t)}}async getSelectedUIFont(){try{return(await this.getSettings()).selectedUIFont||"readable"}catch(e){return console.warn("Get selected UI font error:",e),"readable"}}async saveSelectedUIFont(e){try{await this.saveSettings({selectedUIFont:e})}catch(t){console.warn("Save selected UI font error:",t)}}async cachePrefetchedQuote(e){try{if(this.isErrorQuote(e)){console.warn("Refusing to cache error quote for prefetch:",e.text.substring(0,50));return}const t={...e,timestamp:Date.now()};await this.saveSettings({prefetchedQuote:t})}catch(t){console.warn("Cache prefetched quote error:",t)}}async getPrefetchedQuote(){try{const t=(await this.getSettings()).prefetchedQuote;return t?this.isErrorQuote(t)?(await this.saveSettings({prefetchedQuote:void 0}),null):Date.now()-t.timestamp<60*60*1e3?t:null:null}catch(e){return console.warn("Get prefetched quote error:",e),null}}async consumePrefetchedQuote(){try{const e=await this.getPrefetchedQuote();return e&&(await this.cacheQuote(e),await this.saveSettings({prefetchedQuote:void 0})),e}catch(e){return console.warn("Consume prefetched quote error:",e),null}}}const l=new Q,f=[{text:"The only way to do great work is to love what you do.",author:"Steve Jobs",source:"Built-in"},{text:"Innovation distinguishes between a leader and a follower.",author:"Steve Jobs",source:"Built-in"},{text:"The future belongs to those who believe in the beauty of their dreams.",author:"Eleanor Roosevelt",source:"Built-in"},{text:"It is during our darkest moments that we must focus to see the light.",author:"Aristotle",source:"Built-in"},{text:"Success is not final, failure is not fatal: it is the courage to continue that counts.",author:"Winston Churchill",source:"Built-in"}],n=typeof window<"u"&&window.location.hostname==="localhost";class S{getRandomFallback(){const e=Math.floor(Math.random()*f.length);return f[e]}isErrorResponse(e,t){const o=`${e} ${t}`.toLowerCase();return["too many requests","rate limit","auth key","unlimited access","api error","zenquotes.io"].some(a=>o.includes(a))}async fetchFromZenQuotes(){var e,t;try{n&&console.log("Fetching from ZenQuotes...");const o=await fetch("https://zenquotes.io/api/random");if(!o.ok)throw new Error(`ZenQuotes request failed: ${o.status} ${o.statusText}`);const s=await o.json();if(s&&s.length>0){const a=String(((e=s[0])==null?void 0:e.q)??""),i=String(((t=s[0])==null?void 0:t.a)??"");if(this.isErrorResponse(a,i))throw new Error(`ZenQuotes returned error as quote: ${a.substring(0,50)}`);const u={text:a,author:i,source:"ZenQuotes"};return n&&console.log("ZenQuotes response:",u),u}throw new Error("No quote data received")}catch(o){throw n&&console.warn("ZenQuotes fetch failed:",o),o}}async fetchFromQuoteGarden(){try{n&&console.log("Fetching from QuoteGarden...");const e=await fetch("https://quote-garden.herokuapp.com/api/v3/quotes/random");if(!e.ok)throw new Error(`QuoteGarden request failed: ${e.status} ${e.statusText}`);const t=await e.json();if(t&&t.statusCode===200&&t.data){const o={text:t.data.quoteText.replace(/[""]/g,""),author:t.data.quoteAuthor,source:"Quote Garden"};return n&&console.log("QuoteGarden response:",o),o}throw new Error("No quote data received")}catch(e){throw n&&console.warn("QuoteGarden fetch failed:",e),e}}async getRandomQuote(){n&&console.log("Getting random quote...");const e=[()=>this.fetchFromZenQuotes(),()=>this.fetchFromQuoteGarden()];for(const t of e)try{return await t()}catch{continue}return n&&console.log("All APIs failed, using fallback quote"),this.getRandomFallback()}async getTodaysQuote(){var e,t;try{n&&console.log("Getting today's quote...");const o=await fetch("https://zenquotes.io/api/today");if(!o.ok)throw new Error(`ZenQuotes today request failed: ${o.status} ${o.statusText}`);const s=await o.json();if(s&&s.length>0){const a=String(((e=s[0])==null?void 0:e.q)??""),i=String(((t=s[0])==null?void 0:t.a)??"");if(this.isErrorResponse(a,i))throw new Error(`ZenQuotes today returned error as quote: ${a.substring(0,50)}`);const u={text:a,author:i,source:"ZenQuotes (Today)"};return n&&console.log("Today's quote response:",u),u}throw new Error("No today quote available")}catch(o){return n&&console.warn("Today's quote fetch failed, falling back to random:",o),this.getRandomQuote()}}async prefetchNextQuote(){try{n&&console.log("Prefetching next quote...");const e=await this.getRandomQuote();await l.cachePrefetchedQuote({...e,source:e.source??"Unknown"}),n&&console.log("Next quote prefetched:",e)}catch(e){n&&console.warn("Prefetch failed:",e)}}}const h=new S;let c=!0;chrome.storage.local.get(["dqEnabled"],r=>{c=r.dqEnabled!==!1;const e=c?{16:"icons/icon16.png",32:"icons/icon32.png",48:"icons/icon48.png",128:"icons/icon128.png"}:{16:"icons/icon16_gray.png",32:"icons/icon32_gray.png",48:"icons/icon48_gray.png",128:"icons/icon128_gray.png"};chrome.action.setIcon({path:e}),chrome.action.setTitle({title:c?"Click to hide quote":"Click to show quote"})});chrome.action.onClicked.addListener(async()=>{c=!c;const r=c?{16:"icons/icon16.png",32:"icons/icon32.png",48:"icons/icon48.png",128:"icons/icon128.png"}:{16:"icons/icon16_gray.png",32:"icons/icon32_gray.png",48:"icons/icon48_gray.png",128:"icons/icon128_gray.png"};chrome.action.setIcon({path:r}),chrome.action.setTitle({title:c?"Click to hide quote":"Click to show quote"}),chrome.storage.local.set({dqEnabled:c})});chrome.runtime.onInstalled.addListener(async()=>{chrome.alarms.create("dailyQuote",{delayInMinutes:0,periodInMinutes:24*60});const r=await h.getTodaysQuote();await l.cacheQuote({text:r.text,author:r.author,source:r.source||"Unknown"})});chrome.alarms.onAlarm.addListener(async r=>{if(r.name==="dailyQuote"){const e=await h.getTodaysQuote();await l.cacheQuote({text:e.text,author:e.author,source:e.source||"Unknown"}),await h.prefetchNextQuote()}});export{h as q,l as s};
