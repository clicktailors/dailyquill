var p=Object.defineProperty;var q=(o,e,t)=>e in o?p(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var f=(o,e,t)=>q(o,typeof e!="symbol"?e+"":e,t);const b="modulepreload",F=function(o){return"/"+o},w={},x=function(e,t,r){let d=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));d=Promise.allSettled(t.map(c=>{if(c=F(c),c in w)return;w[c]=!0;const u=c.endsWith(".css"),S=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${S}`))return;const i=document.createElement("link");if(i.rel=u?"stylesheet":b,u||(i.as="script"),i.crossOrigin="",i.href=c,a&&i.setAttribute("nonce",a),document.head.appendChild(i),u)return new Promise((v,Q)=>{i.addEventListener("load",v),i.addEventListener("error",()=>Q(new Error(`Unable to preload CSS for ${c}`)))})}))}function g(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return d.then(s=>{for(const a of s||[])a.status==="rejected"&&g(a.reason);return e().catch(g)})},m=[{text:"The only way to do great work is to love what you do.",author:"Steve Jobs",source:"Built-in"},{text:"Innovation distinguishes between a leader and a follower.",author:"Steve Jobs",source:"Built-in"},{text:"The future belongs to those who believe in the beauty of their dreams.",author:"Eleanor Roosevelt",source:"Built-in"},{text:"It is during our darkest moments that we must focus to see the light.",author:"Aristotle",source:"Built-in"},{text:"Success is not final, failure is not fatal: it is the courage to continue that counts.",author:"Winston Churchill",source:"Built-in"}],n=window.location.hostname==="localhost";class T{getRandomFallback(){const e=Math.floor(Math.random()*m.length);return m[e]}async fetchFromZenQuotes(){try{n&&console.log("Fetching from ZenQuotes...");const t=await(await fetch("https://zenquotes.io/api/random")).json();if(t&&t.length>0){const r={text:t[0].q,author:t[0].a,source:"ZenQuotes"};return n&&console.log("ZenQuotes response:",r),r}throw new Error("No quote data received")}catch(e){throw n&&console.warn("ZenQuotes fetch failed:",e),e}}async fetchFromQuoteGarden(){try{n&&console.log("Fetching from QuoteGarden...");const t=await(await fetch("https://quote-garden.herokuapp.com/api/v3/quotes/random")).json();if(t&&t.statusCode===200&&t.data){const r={text:t.data.quoteText.replace(/[""]/g,""),author:t.data.quoteAuthor,source:"Quote Garden"};return n&&console.log("QuoteGarden response:",r),r}throw new Error("No quote data received")}catch(e){throw n&&console.warn("QuoteGarden fetch failed:",e),e}}async getRandomQuote(){n&&console.log("Getting random quote...");const e=[()=>this.fetchFromZenQuotes(),()=>this.fetchFromQuoteGarden()];for(const t of e)try{return await t()}catch{continue}return n&&console.log("All APIs failed, using fallback quote"),this.getRandomFallback()}async getTodaysQuote(){try{n&&console.log("Getting today's quote...");const t=await(await fetch("https://zenquotes.io/api/today")).json();if(t&&t.length>0){const r={text:t[0].q,author:t[0].a,source:"ZenQuotes (Today)"};return n&&console.log("Today's quote response:",r),r}throw new Error("No today quote available")}catch(e){return n&&console.warn("Today's quote fetch failed, falling back to random:",e),this.getRandomQuote()}}async prefetchNextQuote(){try{n&&console.log("Prefetching next quote...");const e=await this.getRandomQuote(),{storageService:t}=await x(async()=>{const{storageService:r}=await Promise.resolve().then(()=>k);return{storageService:r}},void 0);await t.cachePrefetchedQuote(e),n&&console.log("Next quote prefetched:",e)}catch(e){n&&console.warn("Prefetch failed:",e)}}}const l=new T,P=window.location.hostname==="localhost",E={sync:{get:async o=>{const e=localStorage.getItem(`chrome.storage.sync.${o}`);return e?JSON.parse(e):{}},set:async o=>{Object.entries(o).forEach(([e,t])=>{localStorage.setItem(`chrome.storage.sync.${e}`,JSON.stringify(t))})}}},y=P?E:chrome.storage;class I{constructor(){f(this,"defaultSettings",{preferredSource:"random",showSource:!0,favoriteQuotes:[],lastFetchTime:0,selectedTheme:"default",themeMode:"system"})}async getSettings(){try{const e=await y.sync.get("settings");return{...this.defaultSettings,...e.settings}}catch(e){return console.warn("Storage service error:",e),this.defaultSettings}}async saveSettings(e){try{const r={...await this.getSettings(),...e};await y.sync.set({settings:r})}catch(t){console.warn("Storage service error:",t)}}async cacheQuote(e){try{const t={...e,timestamp:Date.now()};await this.saveSettings({cachedQuote:t,lastFetchTime:Date.now()})}catch(t){console.warn("Cache quote error:",t)}}async getCachedQuote(){try{const t=(await this.getSettings()).cachedQuote;return t&&Date.now()-t.timestamp<24*60*60*1e3?t:null}catch(e){return console.warn("Get cached quote error:",e),null}}async shouldFetchNewQuote(){try{const e=await this.getSettings();return Date.now()-e.lastFetchTime>10*60*1e3}catch(e){return console.warn("Should fetch new quote error:",e),!0}}async getSelectedTheme(){try{return(await this.getSettings()).selectedTheme}catch(e){return console.warn("Get selected theme error:",e),"default"}}async saveSelectedTheme(e){try{await this.saveSettings({selectedTheme:e})}catch(t){console.warn("Save selected theme error:",t)}}async getSelectedQuoteFont(){try{return(await this.getSettings()).selectedQuoteFont||"classic"}catch(e){return console.warn("Get selected quote font error:",e),"classic"}}async saveSelectedQuoteFont(e){try{await this.saveSettings({selectedQuoteFont:e})}catch(t){console.warn("Save selected quote font error:",t)}}async getSelectedUIFont(){try{return(await this.getSettings()).selectedUIFont||"readable"}catch(e){return console.warn("Get selected UI font error:",e),"readable"}}async saveSelectedUIFont(e){try{await this.saveSettings({selectedUIFont:e})}catch(t){console.warn("Save selected UI font error:",t)}}async cachePrefetchedQuote(e){try{const t={...e,timestamp:Date.now()};await this.saveSettings({prefetchedQuote:t})}catch(t){console.warn("Cache prefetched quote error:",t)}}async getPrefetchedQuote(){try{const t=(await this.getSettings()).prefetchedQuote;return t&&Date.now()-t.timestamp<60*60*1e3?t:null}catch(e){return console.warn("Get prefetched quote error:",e),null}}async consumePrefetchedQuote(){try{const e=await this.getPrefetchedQuote();return e&&(await this.cacheQuote(e),await this.saveSettings({prefetchedQuote:void 0})),e}catch(e){return console.warn("Consume prefetched quote error:",e),null}}}const h=new I,k=Object.freeze(Object.defineProperty({__proto__:null,storageService:h},Symbol.toStringTag,{value:"Module"}));chrome.runtime.onInstalled.addListener(async()=>{chrome.alarms.create("dailyQuote",{delayInMinutes:0,periodInMinutes:24*60});const o=await l.getTodaysQuote();await h.cacheQuote({text:o.text,author:o.author,source:o.source||"Unknown"})});chrome.alarms.onAlarm.addListener(async o=>{if(o.name==="dailyQuote"){const e=await l.getTodaysQuote();await h.cacheQuote({text:e.text,author:e.author,source:e.source||"Unknown"}),await l.prefetchNextQuote()}});export{l as q,h as s};
